{% load i18n %}
{% load content_filters %}
{% load page_filters %}
{% load tree_filters %}
{% get_translation page language.slug as page_translation %}

<tr id="page-{{ page.id }}-drop-left"
    data-drop-id="{{ page.id }}"
    data-drop-position="left"
    class="drop {% if not parent_id %} drop-between{% endif %} h-3 -m-3 hidden level-{{ page.relative_depth }}">
    <td colspan="7">
        <div>
            {# djlint:off H020 #}
            <span></span>
            {# djlint:on #}
        </div>
    </td>
</tr>
<tr id="page-{{ page.id }}"
    data-drop-id="{{ page.id }}"
    data-drop-position="last-child"
    class="page-row drop drop-on border-t border-b border-solid border-gray-200 hover:bg-gray-100 level-{{ page.relative_depth }} {% if parent_id %} hidden parent-page-{{ parent_id }}{% endif %}">
<form id="translate-pages-form" method="post">
   {% csrf_token %}
   {% if not filter_form.is_enabled %}
        <td class="hierarchy single_icon whitespace-nowrap">
            <span data-drag-id="{{ page.id }}"
                  data-node-descendants="{{ page|get_descendant_ids }}"
                  class="drag cursor-move text-gray-800 inline-block pl-4 align-middle"
                  draggable="true"
                  title="{% translate "Change the order and position of the pages with drag & drop." %}">
                <i icon-name="move"></i>
            </span>
            {% if not page.parent_id and not page.is_leaf or page.parent_id and page.cached_children|length > 0 %}
                <span class="toggle-subpages inline-block align-middle cursor-wait transform"
                      data-expand-title="{% translate "Expand all subpages" %}"
                      data-collapse-title="{% translate "Collapse all subpages" %}"
                      data-page-id="{{ page.id }}"
                      data-page-children="{{ page|get_children_ids }}"
                      data-page-descendants-url="{% url 'get_translate_pages_tree_ajax' region_slug=request.region.slug language_slug=language.slug tree_id=page.tree_id %}">
                    <i icon-name="chevron-right"></i>
                </span>
            {% endif %}
        </td>
    {% endif %}
    <td>
        <a href="{% url 'edit_page' page_id=page.id region_slug=request.region.slug language_slug=language.slug %}"
           class="block py-1.5 px-2 overflow-hidden max-w-xs whitespace-nowrap text-ellipsis text-gray-800"
           title="{% if page_translation %} {{ page_translation.title }}{% endif %}">
            {% if page_translation %}
                {{ page_translation.title }} 
            {% else %}
                <i>{% translate "Translation not available" %}</i>
            {% endif %}
        </a>
    </td>
    {% if backend_language and backend_language != language %}
        <td>
            <a href="{% url 'edit_page' page_id=page.id region_slug=request.region.slug language_slug=LANGUAGE_CODE %}"
               class="block py-1.5 px-2 overflow-hidden max-w-xs whitespace-nowrap text-ellipsis text-gray-800"
               title="{% if page.backend_translation %} {{ page.backend_translation.title }}{% endif %}">
                <div class="translation-title">
                    {% if page.backend_translation %}
                        {{ page.backend_translation.title }}
                    {% else %}
                        <i>{% translate "Translation not available" %}</i>
                    {% endif %}
                </div>
            </a>
        </td>
    {% endif %}
    <td class="whitespace-nowrap">
        <div class="block py-1.5 px-2 text-gray-800">
            {% for tag in page_translation.tags %}
                <span class="bg-orange-400 text-white rounded px-2 py-1">{{ tag }}</span>
            {% endfor %}
        </div>
    </td>
    <td class="whitespace-nowrap">
        <div class="block py-1.5 px-2 text-gray-800">
            <div class="lang-grid">
                {% spaceless %}
                    {% for other_language, other_status in page.translation_states.values %}
                        <a href="{% url 'edit_page' page_id=page.id region_slug=request.region.slug language_slug=other_language.slug %}"
                           class="{{ other_language.slug }}">
                            <div id="translation-icon">
                                {% if other_status == translation_status.IN_TRANSLATION %}
                                    <span title="{% translate "Currently in translation" %}">
                                        <i icon-name="clock"
                                           class="{% if other_language.slug == language.slug %}text-blue-500{% else %}text-gray-800{% endif %}"></i>
                                    </span>
                                {% elif other_status == translation_status.OUTDATED %}
                                    <span title="{% translate "Translation outdated" %}">
                                        <i icon-name="alert-triangle"
                                           class="{% if other_language.slug == language.slug %}text-yellow-500{% else %}text-gray-800{% endif %}"></i>
                                    </span>
                                {% elif other_status == translation_status.UP_TO_DATE %}
                                    <span title="{% translate "Translation up-to-date" %}">
                                        <i icon-name="check"
                                           class="{% if other_language.slug == language.slug %}text-green-500{% else %}text-gray-800{% endif %}"></i>
                                    </span>
                                {% elif other_status == translation_status.MISSING %}
                                    <span title="{% translate "Translation missing" %}" class="no-trans">
                                        <i icon-name="x"
                                           class="{% if other_language.slug == language.slug %}text-red-500{% else %}text-gray-800{% endif %}"></i>
                                    </span>
                                {% endif %}
                            </div>
                            <div id="ajax-icon" class="hidden">
                                <span title="{% translate "Currently in translation" %}">
                                    <i icon-name="clock"
                                       class="{% if other_language.slug == language.slug %}text-blue-500{% else %}text-gray-800{% endif %}"></i>
                                </span>
                            </div>
                        </a>
                    {% endfor %}
                {% endspaceless %}
            </div>
        </div> 
    </td>
    <td>
        <div id="translate-language-selector-{{ page.id }}" class="select-container flex-col text-lg w-full relative inline-block">
            <span class="relative inline-block hover:bg-gray-200 cursor-pointer flex justify-between bg-white py-2 px-4 rounded shadow hover:bg-gray-200 border-2 border-white whitespace-nowrap">
                {% translate "Select language" %}
            <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" icon-name="chevron-down" class="lucide lucide-chevron-down -mr-2 h-5 inline-block" id="translate-language-selector-chevron-{{ page.id }}"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </span>
            </span>
            
            <div class="select-list bg-white w-full absolute z-10 flex-col hover:visible hidden">
                <ul id="translate-language-selector-ul-{{ page.id }}">
                    <label class="font-normal shadow whitespace-nowrap {% if forloop.last %} rounded-b{% endif %} px-4 py-2 m-0 text-gray-800 hover:bg-gray-200 bg-white">
                        <input type="checkbox" id="select-all" value="all">
                        {% translate "Select all" %}
                    </label>
                    {% for language in languages_to_translate %}
                    <label class="font-normal shadow whitespace-nowrap {% if forloop.last %} rounded-b{% endif %} px-4 py-2 m-0 text-gray-800 hover:bg-gray-200 bg-white">
                        <input type="checkbox" value="{{ language.id }}">
                        {{ language }}
                    </label>
                    {% endfor %}
                </ul>
            </div>
        </div>
     </td>
    <td> 
        <div class="pl-2 pr-4 py-1.5 text-right flex flex-nowrap gap-2">
        <!-- @TODO:  9 {{ page_translation.hix_value }} --> 
        </div>
    </td>
    <td>
        <div class="pl-2 pr-4 py-1.5 text-right flex flex-nowrap gap-2" >
            <!-- @TODO - check value / variable setting -->
        <!-- { if page_translation.hix_value > MIN_HIX_TO_TRANSLATE  } -->
        {% if page_translation.title == "Willkommen"  %}
            <button id="translate-page-submit-{{ page.id }}" class="btn" disabled="">{% translate "Translate" %}</button>
        {% else  %}
            <a href="{% url 'edit_page' page_id=page.id region_slug=request.region.slug language_slug=page_translation.language.slug %}" class="btn disabled">                    {% translate "Adjust HIX-value" %}
            </a><br />
        {% endif %}
        </div>
    </td>
</form>
</tr>
